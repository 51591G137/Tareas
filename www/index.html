<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Gestor Elite</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

    <!-- Pantalla de inicio -->
    <div id="screen-home" class="screen active">
        <h2 style="text-align: center; margin-top: 40px;">Hola, ¬øqui√©n eres?</h2>
        <p style="text-align: center; color: #666;">Selecciona tu perfil</p>
        <div id="users-list-home"></div>
        
        <button class="settings-btn" onclick="navTo('screen-settings')">‚öôÔ∏è</button>
    </div>

    <!-- Pantalla de configuraci√≥n -->
    <div id="screen-settings" class="screen">
        <button class="secondary small" onclick="navTo('screen-home')" style="margin-bottom: 15px;">‚¨Ö Volver</button>
        <h3>Configuraci√≥n</h3>
        
        <div class="config-tabs">
            <button class="config-tab active" onclick="showConfigTab('tab-users')">üë• Usuarios</button>
            <button class="config-tab" onclick="showConfigTab('tab-tasks')">üìã Tareas</button>
            <button class="config-tab" onclick="showConfigTab('tab-badges')">üéñÔ∏è Insignias</button>
            <button class="config-tab" onclick="showConfigTab('tab-backup')">üíæ Backup</button>
        </div>

        <!-- TAB: Usuarios -->
        <div id="tab-users" class="config-tab-content">
            <div class="card">
                <h4>Gestionar Usuarios</h4>
                <input type="text" id="new-user-name" placeholder="Nombre nuevo usuario">
                <button onclick="createUser()">A√±adir Usuario</button>
                <div id="users-manage-list" style="margin-top:15px;"></div>
            </div>

            <div class="card">
                <h4>Editar Puntuaciones de Usuarios</h4>
                <p style="font-size: 12px; color: #666;">Modifica directamente los puntos de cada usuario</p>
                <select id="edit-scores-user" onchange="loadUserScores()">
                    <option value="">Selecciona un usuario</option>
                </select>
                <div id="user-scores-editor" style="display:none; margin-top:10px;"></div>
            </div>
        </div>

        <!-- TAB: Tareas -->
        <div id="tab-tasks" class="config-tab-content" style="display:none;">
            <div class="card">
                <h4>Gesti√≥n de Categor√≠as</h4>
                <p style="font-size: 12px; color: #666;">A√±ade, edita o elimina categor√≠as. Arrastra para reordenar.</p>
                <input type="text" id="new-category" placeholder="Nueva categor√≠a (ej: Puntualidad)">
                <button onclick="addCategory()">+ A√±adir Categor√≠a</button>
                <div id="categories-list" style="margin-top: 15px;"></div>
            </div>

            <div class="card">
                <h4>Crear Tarea Global</h4>
                <input type="text" id="gt-title" placeholder="T√≠tulo de la tarea">
                <label style="font-size: 12px; color: #666; margin-top: 5px;">Fecha (opcional):</label>
                <input type="date" id="gt-date">
                
                <p style="margin: 10px 0 5px 0;"><strong>Asignar a:</strong></p>
                <div id="gt-user-assign" class="user-checkbox-list"></div>

                <div style="margin: 10px 0;">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="gt-repeat" onchange="toggleRepeat()" style="width: auto; margin: 0;"> 
                        ¬øSe repite?
                    </label>
                </div>

                <div id="repeat-options" style="display:none;">
                    <p style="margin: 5px 0;"><strong>D√≠as de repetici√≥n:</strong></p>
                    <div class="days-selector">
                        <label class="day-check">L<input type="checkbox" class="day-opt" value="1"></label>
                        <label class="day-check">M<input type="checkbox" class="day-opt" value="2"></label>
                        <label class="day-check">X<input type="checkbox" class="day-opt" value="3"></label>
                        <label class="day-check">J<input type="checkbox" class="day-opt" value="4"></label>
                        <label class="day-check">V<input type="checkbox" class="day-opt" value="5"></label>
                        <label class="day-check">S<input type="checkbox" class="day-opt" value="6"></label>
                        <label class="day-check">D<input type="checkbox" class="day-opt" value="0"></label>
                    </div>
                </div>

                <h4 style="margin-top: 15px;">Puntuaciones</h4>
                <div id="gt-scores"></div>
                
                <button onclick="saveGlobalTask()" style="margin-top:10px;">Crear Tareas</button>
            </div>

            <div class="card">
                <h4>Tareas Globales Creadas</h4>
                <div id="global-tasks-list"></div>
            </div>
        </div>

        <!-- TAB: Insignias -->
        <div id="tab-badges" class="config-tab-content" style="display:none;">
            <div class="card">
                <h4>Crear Insignia</h4>
                <p style="font-size: 12px; color: #666;">Crea insignias que se desbloquean al alcanzar puntos</p>
                
                <label style="font-size: 12px;">Nombre de la insignia:</label>
                <input type="text" id="badge-name" placeholder="Ej: Maestro del Orden">
                
                <label style="font-size: 12px;">Emoji/Icono:</label>
                <input type="text" id="badge-emoji" placeholder="Ej: üèÜ ‚≠ê üéñÔ∏è üëë" maxlength="2">
                
                <label style="font-size: 12px;">Tipo de requisito:</label>
                <select id="badge-req-type" onchange="toggleBadgeRequirements()">
                    <option value="total">Puntos totales (suma de todas las categor√≠as)</option>
                    <option value="category">Puntos en categor√≠a espec√≠fica</option>
                    <option value="multiple">Puntos en m√∫ltiples categor√≠as</option>
                </select>
                
                <div id="badge-total-req" style="margin-top: 10px;">
                    <label style="font-size: 12px;">Puntos totales necesarios:</label>
                    <input type="number" id="badge-total-points" placeholder="Ej: 10" min="1">
                </div>

                <div id="badge-category-req" style="display: none; margin-top: 10px;">
                    <label style="font-size: 12px;">Categor√≠a:</label>
                    <select id="badge-category"></select>
                    <label style="font-size: 12px;">Puntos necesarios:</label>
                    <input type="number" id="badge-category-points" placeholder="Ej: 100" min="1">
                </div>

                <div id="badge-multiple-req" style="display: none; margin-top: 10px;">
                    <p style="font-size: 12px;"><strong>Puntos necesarios por categor√≠a:</strong></p>
                    <div id="badge-multiple-scores"></div>
                </div>
                
                <button onclick="addBadge()" style="background: var(--success); margin-top: 10px;">+ A√±adir Insignia</button>
            </div>

            <div class="card">
                <h4>Insignias Creadas</h4>
                <div id="badges-list"></div>
            </div>
        </div>

        <!-- TAB: Backup -->
        <div id="tab-backup" class="config-tab-content" style="display:none;">
            <div class="card">
                <h4>Copia de Seguridad</h4>
                <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
                    Guarda todos tus datos (usuarios, tareas, puntuaciones, insignias).
                </p>
                <button onclick="exportBackup()" style="background: var(--success);">üì§ Compartir/Crear Backup</button>
                
                <h4 style="margin-top: 20px;">Restaurar Backup</h4>
                <p style="font-size: 12px; color: #666; margin-bottom: 10px;">
                    Elige c√≥mo quieres restaurar tus datos:
                </p>
                <button class="secondary" onclick="showPasteBackup()">üìã Pegar Backup</button>
                <button class="secondary" onclick="document.getElementById('import-file').click();" style="margin-top: 10px;">üìÅ Subir Archivo</button>
                <input type="file" id="import-file" accept=".json,.txt" style="display:none;" onchange="importBackup(event)">
                
                <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border-radius: 5px; border-left: 4px solid #ffc107;">
                    <small style="color: #856404;">
                        <strong>‚ö†Ô∏è Importante:</strong> Al restaurar un backup, se reemplazar√°n todos los datos actuales.
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Aplicaci√≥n principal -->
    <div id="main-app" style="display:none;">
        <div style="position: fixed; top: 0; left: 0; right: 0; background: #fff; padding: 15px 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 200; display: flex; justify-content: space-between; align-items: center;">
            <h2 id="user-title" style="margin: 0;">Tareas</h2>
            <button class="danger small" onclick="logout()">Salir</button>
        </div>

        <div style="padding-top: 70px;">
            <div id="view-tasks" class="screen">
                <div id="tasks-container"></div>
            </div>

            <div id="view-calendar" class="screen">
                <h3 style="margin-top: 0;">Calendario</h3>
                <div id="calendar-container"></div>
            </div>

            <div id="view-scores" class="screen">
                <h3 style="margin-top: 0;">Mi Puntuaci√≥n</h3>
                <div id="scores-container"></div>
            </div>

            <div id="view-badges" class="screen">
                <h3 style="margin-top: 0;">Mis Insignias</h3>
                <div id="badges-container"></div>
            </div>
        </div>

        <nav class="nav-bottom">
            <button class="nav-btn" onclick="showView('view-tasks')">Tareas</button>
            <button class="nav-btn" onclick="showView('view-calendar')">Calendario</button>
            <button class="nav-btn" onclick="showView('view-scores')">Puntos</button>
            <button class="nav-btn" onclick="showView('view-badges')">Insignias</button>
        </nav>
    </div>

    <!-- Modales -->
    <div id="status-modal" class="modal">
        <div class="modal-content">
            <h3>Cambiar estado de tarea</h3>
            <p id="modal-task-title"></p>
            <div class="task-actions">
                <button class="secondary" onclick="changeTaskStatus('En espera')">‚è≥ En espera</button>
                <button style="background: var(--info);" onclick="changeTaskStatus('En proceso')">üîÑ En proceso</button>
                <button style="background: var(--success);" onclick="changeTaskStatus('Terminada')">‚úÖ Terminada</button>
                <button class="danger" onclick="changeTaskStatus('Perdida')">‚ùå Perdida</button>
            </div>
            <button class="secondary" onclick="closeStatusModal()" style="margin-top: 15px;">Cancelar</button>
        </div>
    </div>

    <div id="edit-task-modal" class="modal">
        <div class="modal-content">
            <h3>Editar Tarea</h3>
            <input type="text" id="edit-task-title" placeholder="T√≠tulo">
            <input type="date" id="edit-task-date">
            
            <p style="margin: 10px 0 5px 0;"><strong>Asignar a:</strong></p>
            <div id="edit-task-user-assign" class="user-checkbox-list"></div>

            <div style="margin: 10px 0;">
                <label style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="edit-task-repeat" onchange="toggleEditRepeat()" style="width: auto; margin: 0;"> 
                    ¬øSe repite?
                </label>
            </div>

            <div id="edit-repeat-options" style="display:none;">
                <p style="margin: 5px 0;"><strong>D√≠as de repetici√≥n:</strong></p>
                <div class="days-selector">
                    <label class="day-check">L<input type="checkbox" class="edit-day-opt" value="1"></label>
                    <label class="day-check">M<input type="checkbox" class="edit-day-opt" value="2"></label>
                    <label class="day-check">X<input type="checkbox" class="edit-day-opt" value="3"></label>
                    <label class="day-check">J<input type="checkbox" class="edit-day-opt" value="4"></label>
                    <label class="day-check">V<input type="checkbox" class="edit-day-opt" value="5"></label>
                    <label class="day-check">S<input type="checkbox" class="edit-day-opt" value="6"></label>
                    <label class="day-check">D<input type="checkbox" class="edit-day-opt" value="0"></label>
                </div>
            </div>

            <h4>Puntuaciones</h4>
            <div id="edit-task-scores"></div>

            <div class="modal-buttons">
                <button onclick="saveEditedTask()">Guardar</button>
                <button class="secondary" onclick="closeEditModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="paste-backup-modal" class="modal">
        <div class="modal-content">
            <h3>Pegar Backup</h3>
            <p style="font-size: 12px; color: #666;">Pega aqu√≠ el contenido del backup que copiaste:</p>
            <textarea id="paste-backup-text" placeholder="Pega aqu√≠ el backup..." style="width:100%;height:250px;font-family:monospace;font-size:11px;padding:10px;border:1px solid #ddd;border-radius:5px;margin:10px 0;box-sizing:border-box;"></textarea>
            <div class="modal-buttons">
                <button onclick="processPastedBackup()" style="background: var(--success);">‚úÖ Restaurar</button>
                <button class="secondary" onclick="closePasteBackupModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="edit-badge-modal" class="modal">
        <div class="modal-content">
            <h3>Editar Insignia</h3>
            <input type="text" id="edit-badge-name" placeholder="Nombre">
            <input type="text" id="edit-badge-emoji" placeholder="Emoji" maxlength="2">
            
            <label style="font-size: 12px;">Tipo de requisito:</label>
            <select id="edit-badge-req-type" onchange="toggleEditBadgeRequirements()">
                <option value="total">Puntos totales</option>
                <option value="category">Categor√≠a espec√≠fica</option>
                <option value="multiple">M√∫ltiples categor√≠as</option>
            </select>
            
            <div id="edit-badge-total-req" style="margin-top: 10px;">
                <input type="number" id="edit-badge-total-points" placeholder="Puntos totales" min="1">
            </div>

            <div id="edit-badge-category-req" style="display: none; margin-top: 10px;">
                <select id="edit-badge-category"></select>
                <input type="number" id="edit-badge-category-points" placeholder="Puntos" min="1">
            </div>

            <div id="edit-badge-multiple-req" style="display: none; margin-top: 10px;">
                <div id="edit-badge-multiple-scores"></div>
            </div>

            <div class="modal-buttons">
                <button onclick="saveEditedBadge()">Guardar</button>
                <button class="secondary" onclick="closeEditBadgeModal()">Cancelar</button>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/database.js"></script>
    <script src="js/views.js"></script>
    <script src="js/navigation.js"></script>
    <script src="js/users.js"></script>
    <script src="js/categories.js"></script>
    <script src="js/tasks.js"></script>
    <script src="js/badges.js"></script>
    <script src="js/backup.js"></script>
    
    <script>
        // Variable global para usuario actual
        let currentUser = null;
        
        // Inicializar app
        renderHome();
    </script>
</body>
</html>